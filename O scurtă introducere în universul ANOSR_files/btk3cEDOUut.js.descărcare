if (self.CavalryLogger) { CavalryLogger.start_js(["LlbV6"]); }

__d('NotificationCounter',['Arbiter','DocumentTitle','JSLogger','MessengerEnvironment'],(function a(b,c,d,e,f,g){var h={messages:0,notifications:0,requests:0},i={init:function j(){c('Arbiter').subscribe('update_title',this._handleUpdate.bind(this));c('Arbiter').subscribe('jewel/count-updated',this._handleCountUpdate.bind(this));},getCount:function j(){var k=0;for(var l in h){var m=Number(h[l]);if(typeof h[l]=='string'&&isNaN(m))return h[l];if(isNaN(m)||m<0){c('JSLogger').create('jewels').error('bad_count',{jewel:l,count:h[l]});continue;}k+=m;}return k;},updateTitle:function j(){if(c('MessengerEnvironment').messengerui)return;var k=this.getCount(),l=c('DocumentTitle').get();l=k?'('+k+') '+l:l;c('DocumentTitle').set(l,true);},_handleCountUpdate:function j(k,l){h[l.jewel]=l.count;this.updateTitle();},_handleUpdate:function j(k,l){this.updateTitle();}};f.exports=i;}),null);
__d("XNotificationsSyncController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/notifications\/sync\/",{lastSync:{type:"Int",required:true}});}),null);
__d('NotificationSync',['Arbiter','AsyncRequest','ChannelConstants','JSLogger','NotificationConstants','NotificationUpdates','XNotificationsSyncController'],(function a(b,c,d,e,f,g){var h=c('JSLogger').create('notifications'),i='channel_reload',j=0;function k(p){var q=c('NotificationUpdates').getserverTime()?c('NotificationUpdates').getserverTime():j,r=c('XNotificationsSyncController').getURIBuilder().setInt('lastSync',q).getURI();p.setHandler(l).setOption('suppressErrorAlerts',true).setErrorHandler(m).setMethod('GET').setReadOnly(true).setURI(r).setAllowCrossPageTransition(true);}function l(p){var q=p.getPayload();if(q.syncPayload)c('NotificationUpdates').handleUpdate(c('NotificationConstants').PayloadSourceType.SYNC,q.syncPayload);}function m(p){}function n(){var p=new (c('AsyncRequest'))();p.setIsBackgroundRequest(true);k(p);p.send();h.bump(i);}var o={setup:function p(q){j=q;c('Arbiter').subscribe(c('ChannelConstants').ON_INVALID_HISTORY,n);}};f.exports=o;}),null);
__d('NotificationJewelController',['Arbiter','Bootloader','Event','FunnelLogger','NotificationConstants','NotificationCounter','NotificationJewelFunnelLoggingConstants','NotificationSeenState','NotificationStore','NotificationSync','NotificationUpdates','createObjectFrom','curry','isInFocusMode'],(function a(b,c,d,e,f,g){var h=c('NotificationConstants').PayloadSourceType,i=c('NotificationJewelFunnelLoggingConstants').FUNNEL_LOGGING_NAME,j=c('NotificationJewelFunnelLoggingConstants').FUNNEL_LOGGING_EVENT,k=0,l=false;function m(o){var p=c('isInFocusMode')(),q=c('NotificationSeenState').getUnseenCount();c('Arbiter').inform('jewel/count-updated',{jewel:o,count:p?0:q,animation:!p&&l&&q>0?'heart':'none'},c('Arbiter').BEHAVIOR_STATE);}function n(o,p){var q;'use strict';var r=p.badgeAnimationData,s=p.endPoint,t=p.list,u=p.startTime,v=p.unseenNotifs;if(s)c('NotificationStore').registerEndpoint(s);c('NotificationCounter').init();var w=c('Event').listen(o.getRoot(),'mouseover',function(){c('FunnelLogger').startFunnel(i);w&&w.remove();w=null;t.open();c('FunnelLogger').appendAction(i,j.MOUSE_OVER_ON_JEWEL);});if(o.isOpen()){t.open();}else (function(){var y=o.subscribe('opened',function(){y&&y.unsubscribe();y=null;t.open();});})();var x=t.pause.bind(t);o.subscribe('opened',function(){setTimeout(x,0);m(o.name);c('Bootloader').loadModules(["NotificationVPVs"],function(y){return y.clearImpressions();},'NotificationJewelController');c('Arbiter').inform('notificationJewel/opened');});o.subscribe('closed',function(){t.unpause();m(o.name);c('Arbiter').inform('notificationJewel/closed');});c('NotificationUpdates').subscribe('seen-state-updated',c('curry')(m,o.name));if(r){if(r.logWithQEUniverse)c('Bootloader').loadModules(["QE2Logger"],function(y){return y.logExposureForUser(r.logWithQEUniverse);},'NotificationJewelController');if(r.injectWithAnimation)c('Bootloader').loadModules(["RelationshipDelightsBadge"],function(y){return y.inject(o,r.injectWithAnimation);},'NotificationJewelController');c('Bootloader').loadModules(["RelationshipDelightUtils"],function(y){c('NotificationUpdates').subscribe('update-notifications',function(z,aa){var ba=aa.nodes,ca=aa.payloadsource,da=ba&&ba.length?ba.filter(y.shouldHeartBadge):null;if(da&&da.length){l=true;if(r.injectWithAnimation)if(ca===h.INITIAL_LOAD||ca===h.INITIAL_SEND)y.logBadgeAnimation(da[0].alert_id);}else l=false;});if(r.logWithAlertID)y.logBadgeAnimation(r.logWithAlertID);},'NotificationJewelController');}c('NotificationUpdates').handleUpdate(h.INITIAL_LOAD,{seenState:c('createObjectFrom')(v,k)});c('NotificationSync').setup(u);m(o.name);c('NotificationUpdates').setEndPoint(s);}f.exports=n;}),null);